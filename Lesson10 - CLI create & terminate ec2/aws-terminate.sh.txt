#!/bin/bash

# Get a list of running EC2 instances
instance_ids=$(aws ec2 describe-instances \
  --filters "Name=instance-state-name,Values=running" \
  --query "Reservations[].Instances[].InstanceId" \
  --output text)

# Check if there are any running instances
if [ -z "$instance_ids" ]; then
    echo "No running instances found."
else
    # Loop and terminate
    for ec2_id in $instance_ids; do
        echo "Terminating instance: $ec2_id"
        aws ec2 terminate-instances --instance-ids $ec2_id
    done
fi