#!/bin/bash

# Get a list of non-default VPC IDs that are not tagged with 'stay'
non_default_vpcs=$(aws ec2 describe-vpcs --query 'Vpcs[?IsDefault==`false`].VpcId' --output text)

# Check if there are any non-default VPCs
if [ -z "$non_default_vpcs" ]; then
    echo "No non-default VPCs found."
else
    # Loop through each non-default VPC and delete it
    for vpc_id in $non_default_vpcs; do
        echo "Deleting VPC: $vpc_id"

        # Delete associated resources (e.g., subnets, internet gateways, etc.) if needed

aws ec2 detach-internet-gateway --internet-gateway-id your-internet-gateway-id --vpc-id $vpc_id
aws ec2 delete-internet-gateway --internet-gateway-id your-internet-gateway-id






        # Delete the VPC
        aws ec2 delete-vpc --vpc-id $vpc_id

        echo "VPC $vpc_id deleted."
    done
fi